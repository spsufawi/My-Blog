---
title: 用R分析三国志系列武将数据
author: Xinchen Pan
date: '2018-03-25'
slug: RoTC-Analysis
categories:
  - Data Analysis
tags:
  - R
---



<p>写这篇文章有两个原因，第一个是最近在看吴秀波演的《军师联盟》，这部剧剧情紧凑，演员演技精湛，有很多令人惊艳的细节， 重新勾起了我对三国的兴趣。从小到大玩过不少三国游戏，看过很多三国的书，电视剧如央视版三国，高希希版新三国也都不在话下，而这些年除了偶尔玩玩《三国志10》并没有再对三国有什么研究。第二个原因是自己有比较长一段时间没怎么写R, 工作上用到R的机会也不是很多，手有点生，打算用这个数据练练手，加之这是个中文数据，以前没有过用R处理中文数据的经验。</p>
<p>人物数值系统一直是光荣历史游戏的一个特点，它是光荣结合史实，小说，野史等资料对人物的一个全面评价。光荣公司的《三国志》系列可以说是最经典的三国游戏，从1985年第一代推出以来，到现在已经有了十三代作品。而每代出场的数百个武将，经过这么多个版本，他们的各项属性是否会有什么大的变化呢，而这些变化反映了什么呢，这也是这次分析主要想研究的。</p>
<p>我用的武将数据是一个台湾网友（<a href="mailto:cws0324@yahoo.com.tw">cws0324@yahoo.com.tw</a>）收集制作的，它包含了三国志 1-11 所有的武将数据。给人物以数值化好处自然不言而喻，它可以让我们对游戏中武将的强弱有个直观的了解，但坏处就是我们有时候只看重数值，而忽略了该人物在历史上真实的一面。E.g. 伊达政宗，竹中半兵卫。关于这个问题，请参考 <a href="https://zhuanlan.zhihu.com/p/23140678">国内非专业圈中（民科？）日本战国时代历史学习的氛围和现状有感</a></p>
<p>马伯庸在知乎一个问题的回答里做过类似的分析，他用的工具是Excel, 有兴趣的可以去看看. <a href="https://www.zhihu.com/question/21530813">光荣公司《三国志》游戏里的武将设定，是按照三国历史设计的吗？</a></p>
<p>由于自己也是对演义了解的更多，所以分析的时候更多会以演义的角度，再结合史实。话不说多，开始我们的分析。</p>
<div class="section level2">
<h2>1. 数据处理</h2>
<p>首先看下这份数据本身的格式。 <img src="/content/post/RoTC-Analysis_files/attr.png" /></p>
<p>我们发现有多个相同的变量分部在不同的列，而且版本信息占据了多个格子。这种数据不手动处理很难读进R（可能可以？），在excel里也许能很方便的分析处理，但在R里这不属于我们所说的<a href="http://r4ds.had.co.nz/tidy-data.html">干净数据</a>。干净数据有如下定义</p>
<ol style="list-style-type: decimal">
<li>每一个变量必须有它自己的列</li>
<li>每一个样本必须有它自己的行</li>
<li>每一个数值必须在它自己的格子</li>
</ol>
<p>我决定自己手动把版本数据分开到11个表格里，每一个如下图所示。(自然我也可以手动直接得到我们最终想要的数据，但我还是决定用R实现它。） <img src="/post/RoTC-Analysis_files/attr1.png" /></p>
<p>这些是我们需要用到的package.</p>
<pre class="r"><code>library(readxl)
library(dplyr)
library(data.table)
library(tibble)
library(ggplot2)</code></pre>
<p>为了能在R里使用中文，我们用下面的代码将系统locale设置为”Chs”.</p>
<pre class="r"><code>Sys.setlocale(&#39;LC_ALL&#39;,&#39;Chs&#39;)</code></pre>
<p>接着用<code>readxl::read_excel</code>读取数据，每一个版本的数据分别存在了1个data frame里，我们总共有11个data frame，而这11个data frame又都再存在一个list里，<code>lapply</code>返回的就是list结构，我们给它命名为<code>dt</code>.</p>
<pre class="r"><code>dt &lt;- lapply(1:11, function(x) read_excel(&quot;Characters.xlsx&quot;, x)) </code></pre>
<p>由于每一代武将所拥有的属性不一样，为了后边方便，我希望能做一个大的data frame，它的变量有姓名，所有版本的属性以及该人物出场的版本。下面我们来看如何达到这个目的。</p>
<p>我先把每一个版本的数据移除不需要的变量和那一个版本没有出现过的武将，部分NPC各项属性结尾0，我们也将它去掉，把清理过后的数据存到一个新的变量里，叫做<code>series</code>,</p>
<pre class="r"><code>series &lt;- lapply(1:11, function(x) {select(dt[[x]], -c(2:8)) %&gt;%
    filter(complete.cases(dt[[x]][,-c(2:8)])) %&gt;%
    mutate(版本 =  paste0(&quot;三國志&quot;, x)) %&gt;%
    filter(智力!= 0) })</code></pre>
<p>第一代前六个武将是如下几位。</p>
<pre class="r"><code>head(series[[1]])</code></pre>
<pre><code>## # A tibble: 6 x 7
##   姓名    體力  武力  智力  魅力  運勢 版本   
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
## 1 丁奉     81.   22.   81.   29.   47. 三國志1
## 2 于禁     82.   72.   20.   25.   28. 三國志1
## 3 公孫瓚   84.   70.   67.   89.   28. 三國志1
## 4 太史慈   88.   97.   47.   84.   34. 三國志1
## 5 孔融     84.   82.   61.   50.   77. 三國志1
## 6 文聘     88.   84.   22.   64.   83. 三國志1</code></pre>
<p>前边说过，每一代游戏武将拥有的属性不一样，第一代有体力，第二代把统率分成了陆指和水指, 第九代没有魅力。那我们来看下所有作品都有属性是什么，以及每一代都有的属性。</p>
<p>排除姓名和版本，历代都出现过的属性只有武力和智力，这两个属性也是我们后边会主要分析的。</p>
<pre class="r"><code>common_attr &lt;- Reduce(intersect, sapply(series, colnames))
all_attr &lt;- Reduce(union, sapply(series, colnames))
all_attr</code></pre>
<pre><code>##  [1] &quot;姓名&quot; &quot;體力&quot; &quot;武力&quot; &quot;智力&quot; &quot;魅力&quot; &quot;運勢&quot; &quot;版本&quot; &quot;政治&quot; &quot;陸指&quot; &quot;水指&quot;
## [11] &quot;統率&quot;</code></pre>
<pre class="r"><code>common_attr</code></pre>
<pre><code>## [1] &quot;姓名&quot; &quot;武力&quot; &quot;智力&quot; &quot;版本&quot;</code></pre>
<p>因为现在我们的11个data frame是分开的，我们需要把它们合并，但每个data frame的列数不一样，这该如何合并呢。最简单的方法就是用<code>plyr::rbind.fill()</code>， 它可以自动的把缺失值用NA补上。在用这个function之前我尝试了一个非常复杂的方法，这种方法还需要调整变量顺序，这里不多阐述了。</p>
<p>我还调整了版本这个categorical variable的level，使它是按照1-11代的顺序排列， 主要是为了之后做图的时候X轴的值（版本）能够按照正常顺序排列。</p>
<pre class="r"><code>series_full &lt;- do.call(plyr::rbind.fill, series) %&gt;%
   mutate(版本 = factor(版本, levels = paste0(&quot;三國志&quot;, 1:11))) %&gt;%
   select(c(1,11,3:10,2))</code></pre>
<p>现在我们得到了我们想要的这个大的data frame,它是这个样子的。</p>
<pre class="r"><code>head(series_full)</code></pre>
<pre><code>##     姓名 統率 武力 智力 魅力 運勢    版本 政治 陸指 水指 體力
## 1   丁奉   NA   22   81   29   47 三國志1   NA   NA   NA   81
## 2   于禁   NA   72   20   25   28 三國志1   NA   NA   NA   82
## 3 公孫瓚   NA   70   67   89   28 三國志1   NA   NA   NA   84
## 4 太史慈   NA   97   47   84   34 三國志1   NA   NA   NA   88
## 5   孔融   NA   82   61   50   77 三國志1   NA   NA   NA   84
## 6   文聘   NA   84   22   64   83 三國志1   NA   NA   NA   88</code></pre>
</div>
<div class="section level2">
<h2>2. 各项数据分析</h2>
<div class="section level3">
<h3>2.1 各代人物数量分析</h3>
<p>先来看下各代出场的人物数量，</p>
<pre class="r"><code>char_freq &lt;- group_by(series_full, 版本) %&gt;% summarise(人數 = n())
char_freq</code></pre>
<pre><code>## # A tibble: 11 x 2
##    版本      人數
##    &lt;fct&gt;    &lt;int&gt;
##  1 三國志1    256
##  2 三國志2    352
##  3 三國志3    770
##  4 三國志4    454
##  5 三國志5    571
##  6 三國志6    520
##  7 三國志7    539
##  8 三國志8    635
##  9 三國志9    674
## 10 三國志10   650
## 11 三國志11   702</code></pre>
<p>不出所料第一点是出场人物最少的，这些武将想必应该都是我们耳熟能详的武将吧，就像三国杀最早的标准包里只有刘关张等20几个耳熟能详的人物，而现在秦宓， 李丰这种角色都已登场。</p>
<p>再来看十一部作品中都出场的有多少位人物。</p>
<pre class="r"><code>show_in_all &lt;- Reduce(intersect, lapply(series, &quot;[&quot;, 1))
nrow(show_in_all)</code></pre>
<pre><code>## [1] 221</code></pre>
<p>1-11代每一代都出现的角色有221名，我们从里边随机选10个，不出意外都是你可以随便说出他的故事的角色(说出你的故事)。</p>
<pre class="r"><code>sample_n(show_in_all, 10)</code></pre>
<pre><code>## # A tibble: 10 x 1
##    姓名  
##    &lt;chr&gt; 
##  1 韓當  
##  2 郭淮  
##  3 董卓  
##  4 劉琦  
##  5 李儒  
##  6 張昭  
##  7 夏侯楙
##  8 田豐  
##  9 侯成  
## 10 王朗</code></pre>
<p>那有哪些角色出现在了第一部，却在后边某些版本没出现呢。</p>
<pre class="r"><code>show_in_all &lt;- Reduce(intersect, lapply(series, &quot;[&quot;, 1))
setdiff(filter(series_full, 版本 == &quot;三國志1&quot;)$姓名, show_in_all$姓名)</code></pre>
<pre><code>##  [1] &quot;朱褒&quot;   &quot;朱儁&quot;   &quot;呂公&quot;   &quot;宋謙&quot;   &quot;李堪&quot;   &quot;侯選&quot;   &quot;胡軫&quot;  
##  [8] &quot;馬延&quot;   &quot;張既&quot;   &quot;張顗&quot;   &quot;梁綱&quot;   &quot;陳紀&quot;   &quot;陳珪&quot;   &quot;陳琳&quot;  
## [15] &quot;陳嬉&quot;   &quot;陳應&quot;   &quot;陳蘭&quot;   &quot;傅士仁&quot; &quot;傅幹&quot;   &quot;楊奉&quot;   &quot;楊彪&quot;  
## [22] &quot;趙岑&quot;   &quot;劉永&quot;   &quot;劉理&quot;   &quot;劉賢&quot;   &quot;劉璝&quot;   &quot;樂就&quot;   &quot;蔣欽&quot;  
## [29] &quot;蔣幹&quot;   &quot;蔡邕&quot;   &quot;鮑信&quot;   &quot;鍾進&quot;   &quot;韓浩&quot;   &quot;譙周&quot;   &quot;嚴畯&quot;</code></pre>
<p>这些人有些也是比较出名的，比如在《三国演义》中了周瑜反间计的蒋干（没猜方片？），蜀国坚定的投降派，大学者谯周，东吴大将蒋钦，文章能治曹操头痛的建安七子之一的陈琳, 其他大部分都是小角色，韩遂，袁术的一帮子人。</p>
</div>
<div class="section level3">
<h3>2.2. 三国君主数值对比</h3>
<div class="section level4">
<h4>武力对比</h4>
<p><img src="/post/RoTC-Analysis_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
三国志1作为一款1985年出品的游戏，可能在人物数值上稍欠考究，在这一代中，孙权和曹操的武力达到了惊人的94，93，从网上搜寻的资料来看，曹操的武力高于一般士兵是没问题的。
<pre>
<code>
兵谋叛，夜烧太祖帐，太祖手剑杀数十人，馀皆披靡，乃得出营；其不叛者五百馀人。——《魏书》
</code>
</pre>
<p>关于孙权的武力的描述不多，不过有记载他曾经干过老虎。虽然是用了武器。</p>
<pre>
<code>
二十三年十月，权将如吴，亲乘马射虎於庱亭。马为虎所伤，权投以双戟，虎卻废，常从张世击以戈，
获之。——《吴传记》
</code>
</pre>
<p>我并没有特意去查有关刘备武义的描述，三英战吕布虽然是虚构的，但我们有理由相信罗贯中的虚构大部分会建立在一定的史实基础上，如果刘备手无缚鸡之力，没拿过武器，估计情节就是双英战吕布了。而且刘备早年讨伐黄巾贼也都是身先士卒，多次亲临沙场，这也是需要勇武的。</p>
<p>所以孙曹刘武力都最终稳定在70上下，我认为比较科学。</p>
</div>
<div class="section level4">
<h4>智力对比</h4>
<p><img src="/post/RoTC-Analysis_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>从图中可以看到除了曹操每一代智力都稳定在90以上，孙权和刘备的智力都呈下降趋势，分别稳定在80和70左右，这还是比较合理的，一来是刘备在整部《三国演义》里都没有什么出彩的料敌制胜，智谋过人的表现，在诸葛亮出山以前长期依附着不同势力，从曹操，到袁绍，再到刘表，一直没有自己的一片根据地。当然刘备最大的招牌也不是智谋，是仁德，是能得人心，早期实力不济的时候依然选择救援公孙瓒，孔融等诸侯，带新野襄阳数十万百姓逃到江夏，这也能解释为什么关羽张飞等能一直死心塌地跟着刘备，为什么诸葛亮愿意出山。</p>
<p>而曹操192年领兖州牧，收黄巾贼三十万编制为青州兵，之后虽然和吕布，张绣等作战时互有胜负，但至少作为一方势力已成气候。后边能携天子令诸侯，破吕布，收徐州，败袁绍，在不到二十年的时间里统一北方，靠着是自己的大局观，战略眼光，带兵能力以及智谋。曹操手下能臣谋士虽然多，做整体战略部署谋划，拍板的还是曹操。并不是刘备集团那样寡头制，前期诸葛亮，中期一段时间诸葛亮和庞统，后边加上个法正。</p>
<p>孙权18岁接替他哥孙策的位置，接位初期政权不稳，多个州郡发生叛乱，就连孙权的堂兄弟都与曹操内通。而孙权此时一方面继续重用程普，张昭等老臣，一方面广纳贤才，陆逊，鲁肃，诸葛瑾都在这一时期加入了孙权阵营。在完成了江东内的平乱维稳之后，孙权将目标锁定为江夏黄祖，虽未最终攻下江夏，但也多次打败刘表军，并且最终杀死黄祖。之后赤壁之战大获全胜。再后来与曹操在濡须的战斗中，被评价为“生子当如孙仲谋”。虽然孙权一直没打下合肥，并且在逍遥津之战成就了张辽，并且在晚年因继承人问题造成了 <a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%AE%AE%E4%B9%8B%E7%88%AD">二宫之争</a>, 是孙吴折损不少人才(陆逊，步骘的死多少都与此事相关)，但人无完人，总体说来孙权在三国中是个了不起的人物。</p>
<p><img src="/post/RoTC-Analysis_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>刘备和孙权的统率最终又交汇到了75左右。統率指的是带兵打仗能力，刘备一生虽然败仗打得多，但汉中之战也算是个人巅峰，孙权统治江东五十余年，一直没在曹魏的淮南地区占得便宜，虽说镇守合肥的历来都是曹魏的名将，但也稍微说明了点孙权的打仗能力。</p>
</div>
</div>
<div class="section level3">
<h3>2.3 历代最强武力</h3>
<pre class="r"><code>top_attr &lt;- function(attrs, desc = TRUE){
  top_low_data &lt;- lapply(1:11, function(x){filter(final, 版本 == paste0(&quot;三國志&quot;, x)) %&gt;%
  select(c(&quot;姓名&quot;, attrs)) %&gt;%
  filter(eval(parse(text = attrs)) %in% sort(eval(parse(text = attrs)), 
        decreasing = desc)[1:10])}) %&gt;%
  rbindlist()
  
  top_low_times &lt;- top_low_data %&gt;%
    group_by(姓名) %&gt;% 
    summarise(次數 = n(), 均值 = ceiling(mean(eval(parse(text = attrs)), na.rm = TRUE))) %&gt;% 
    arrange(desc(次數)) %&gt;%
    slice(1:10)
  return(list(top_low_data, top_low_times))
}</code></pre>
</div>
</div>
